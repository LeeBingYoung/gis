$(function () {

    Highcharts.setOptions({
        global: {
            useUTC: false
        }
    });

    function activeLastPointToolip(chart) {
        var points = chart.series[0].points;
        chart.tooltip.refresh(points[points.length - 1]);
    }

    $('#chart-direction').highcharts({
        chart: {
            type: 'spline',
            backgroundColor: '',
            animation: Highcharts.svg, // don't animate in old IE
            marginRight: 10,
            events: {
                load: function () {
                    // set up the updating of the chart each second
                    var series = this.series[0],
                        chart = this,
                        i = 0,
                        ydata = new Array(18.361181855370962, 18.753645151772997, 19.163773988420544, 19.59274355189116, 20.041831054239445, 20.512426449904233, 21.006044434159165, 21.524337885793567, 22.06911293588283, 22.642345864741916, 23.24620204985475, 23.883057207728193, 24.170514574359384, 24.41216350915025, 24.658695842186138, 24.910251703158092, 25.166976215982427, 25.429019699264128, 25.69653787475809, 25.969692084043693, 26.248649513614485, 26.533583428567656, 26.824673415055955, 27.12210563163752, 27.426073069625772, 27.58927236429837, 27.688327654960304, 27.78795894329649, 27.88817066021112, 27.9889672741805, 28.090353291512617, 28.19233325660559, 28.294911752204698, 28.398093399658023, 28.501882859170443, 28.606284830055834, 28.711304050987422, 28.69877869256746, 28.631647450900836, 28.564929754704117, 28.49862197366236, 28.43272051754109, 28.367221835671604, 28.302122416443503, 28.23741878680422, 28.173107511765643, 28.109185193917515, 28.135304313596063, 28.21875408466236, 28.302598586426836, 28.38684026458292, 28.471481581180736, 28.55652501470824, 28.641973060171644, 28.727828229175262, 28.814093050000576, 28.9007700676845, 28.987861844096987, 29.073277702946672, 28.789949869893025, 28.51203179312247, 28.239382710889654, 27.971866193470866, 27.709350004006364, 27.451705962956485, 27.19880981621173, 26.95054110687636, 26.7067830507268, 26.467422415330677, 26.232349402798953, 26.00145753613229, 25.774643549113087, 25.595547844090984, 25.35864827243288, 25.126589732397985, 24.899232720683784, 24.67644273723759, 24.45809007891032, 24.244049642220823, 24.034200734843434, 23.828426895442814, 23.626615721491945, 23.428658704721173, 23.35000357087423, 23.401035797034197, 23.452182982889262, 23.5034454355366, 23.554823462720947, 23.606317372832805, 23.657927474906565, 23.709183730301774, 23.67005932885097, 23.631126834695866, 23.592384875006296, 23.553832089659497, 23.515467131097914, 23.47728866418875, 23.439295366085435, 23.401485926090764, 23.3638590455219, 23.32641343757703);

                    setInterval(function () {
                        var x = (new Date()).getTime(), // current time
                            y = ydata[i];
                        i = (i + 1) % 50;
                        series.addPoint([x, y], true, true);
                        activeLastPointToolip(chart)
                    }, 1000);
                }
            }
        },
        title: {
            text: '目标实时数据',
            style: {"color": "white", "fontSize": "0px"}
        },
        xAxis: {
            type: 'datetime',
            tickPixelInterval: 150
        },
        yAxis: {
            title: {
                text: '与原点夹角（°）'
            },
            plotLines: [{
                value: 0,
                width: 1,
                color: '#808080'
            }]
        },
        tooltip: {
            formatter: function () {
                return '<b>' + this.series.name + '</b><br/>' +
                    Highcharts.dateFormat('%Y-%m-%d %H:%M:%S', this.x) + '<br/>' +
                    Highcharts.numberFormat(this.y, 2);
            }
        },
        legend: {
            enabled: false
        },
        exporting: {
            enabled: false
        },
        credits: {
            enabled: false
        },
        series: [{
            name: '方向',
            data: (function () {
                // generate an array of random data
                var data = [],
                    time = (new Date()).getTime(),
                    i;
                for (i = -19; i <= 0; i += 1) {
                    data.push({
                        x: time + i * 1000,
                        y: 0
                    })
                    ;
                }
                return data;
            }())
        }]
    }, function (c) {
        activeLastPointToolip(c)
    });
})